<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <link rel="icon" />
    </head>
    <body></body>

    <script>
var icon=document.querySelector('link[rel*="icon"]'),canvas=new OffscreenCanvas(16,16),context=canvas.getContext("2d"),width=canvas.width,height=canvas.height,back=context.createImageData(width,height),colors=[4278255360,4278255615,4278190335,4294967040,4294902015,4294901760,4278211752],blocks=[108,198,15,204,78,142,46],y=0,x=2,index=0,block=blocks[index],favicon=document.createElement("canvas"),favContext=favicon.getContext("2d");favicon.width=favicon.height=canvas.width;favContext.fillStyle="#000";function trim(a){return 0===(a&4095)?a>>12:0===(a&255)?a>>8:0===(a&15)?a>>4:0===(a&52428)?a>>2:0===(a&34952)?a>>1:a}function rotate(a){return trim(((a&1)<<3)+((a&2)<<6)+((a&4)<<9)+((a&8)<<12)+((a&16)>>2)+((a&32)<<1)+((a&64)<<4)+((a&128)<<7)+((a&256)>>7)+((a&512)>>4)+((a&1024)>>1)+((a&2048)<<2)+((a&4096)>>12)+((a&8192)>>9)+((a&16384)>>6)+((a&32768)>>3),)}function nuke(){for(var a=new Uint32Array(back.data.buffer),b=a.length;0<b;b-=width){for(var c=!0,d=1;d<=width;d+=1){if(0===a[b-d]){c=!1;break}}c&&(a.copyWithin(width,0,b-width),a.fill(0,0,width-1),(b+=width))}}function next(){index=Math.floor(Math.random()*blocks.length);y=0;x=2;back=context.getImageData(0,0,width,height);block=blocks[index];nuke()}function update(){y+=1}function draw(){var a=context.createImageData(back),b=new Uint8ClampedArray(back.data);a.data.set(b);for(var b=new Uint32Array(a.data.buffer),c,d=0,e=0,f=0;16>d;d+=1){e=d%4;f=d>>2;c=((block&(1<<d))>>d)*colors[index];if(0<c&&y+f===height){next();return}if(c){if(0!==b[(y+f)*width+(x+e)]){next();return}b[(y+f)*width+(x+e)]=c}else{}}context.putImageData(a,0,0)}function offsetX(a){return 0===(a&30583)?-3:0===(a&13107)?-2:0===(a&4369)?-1:0}function collision(a){for(var b=new Uint32Array(back.data.buffer),c=0,d=0,e=0;16>c;c+=1){if(((d=c%4),(e=c>>2),(pixel=(a&(1<<c))>>c)&&0!==b[(y+e)*width+(x+d)])){return!0}}return!1}document.onkeydown=function(a){var b=offsetX(block),c=x,d=block;37===a.keyCode?x>b&& --x:39===a.keyCode?x<width-4&&(x+=1):38===a.keyCode&&((block=rotate(block)),(b=offsetX(block)),(x=Math.max(x,b)));collision(block)&&((block=d),(x=c))};var lastTimestamp,speed=200;function loop(a){a-lastTimestamp>speed&&((lastTimestamp=a),update());draw();favContext.fillRect(0,0,16,16);favContext.drawImage(canvas,0,0,16,16);icon.href=favicon.toDataURL("image/png");requestAnimationFrame(loop)}loop((lastTimestamp=performance.now()));    </script>
</html>
